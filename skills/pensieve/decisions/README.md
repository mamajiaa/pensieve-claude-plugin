# Decisions（决策）

记录特定上下文下的项目选择：在什么情境下，为什么选择了什么。

## 目的

Decision 的核心价值是减少重复犯错。

当类似问题再次出现时，团队应能快速回答：
- 当时做了什么选择
- 为什么这么选
- 为什么没选其他方案

## 捕获标准

### 核心判断

> 只有当一条决策能显著降低回归风险、提升可读性或协作效率，并可沉淀成“可复用模式”时，才应进入全局 `decisions/`。

### 三个黄金问题

1. **删掉它后，未来是否更容易犯错？**
2. **三个月后的人看完它，能做出更好决策吗？**
3. **它能被讲清楚并复用吗？**

任一明确“是”即可保留；如果都不明确，先留在 loop 临时目录。

### 五个价值维度

| 维度 | 问题 |
|---|---|
| 长期影响 | 能否减少一类缺陷？ |
| 可读性 | 能否沉淀为可迁移的“代码品味”？ |
| 局部性 | 是否明确了模块边界与职责？ |
| 协作信号 | 是否来自用户明确决策或多次确认？ |
| 噪声过滤 | 是否通过上面的三个黄金问题？ |

## 关系与演化

| 方向 | 说明 |
|---|---|
| Decision -> Maxim | 重复决策可上升为准则 |
| Knowledge -> Decision | 外部知识与项目实践结合后形成决策 |
| Loop -> Decision | loop 中临时决策经过筛选后晋升 |

### 存储位置

| 阶段 | 位置 | 说明 |
|---|---|---|
| loop 期间 | `.claude/pensieve/loop/{name}/_decisions/` | 临时，随 loop 生命周期 |
| loop 结束后 | `.claude/pensieve/decisions/` | 项目级用户数据（永不覆盖） |

### 决策层级

| 层级 | 特征 | 作用范围 |
|---|---|---|
| Hard rule | 违反会导致回归 | 跨项目普适 |
| Coding taste | 降低特殊分支、提高可推理性 | 实现指导 |
| Team preference | 强依赖团队上下文 | 必须显式标注 |

## 链接规则（强制）

Decision 是知识网络主干。每条 decision 必须包含上下文链接。

链接字段：
- `基于`：依赖哪些前置上下文
- `导致`：会触发哪些后续变化
- `相关`：建议一起阅读的平行主题

Hard rule：
- 三个字段中至少一个必须包含有效 `[[linked-note]]`。

## 编写规范

### 目录结构

```
.claude/pensieve/decisions/{date}-{statement}.md
```

命名规则：
- 文件名使用一句话结论（陈述句）
- 文件名回答“决定了什么”
- 文件内容解释“为什么这样决定”

示例：
- `2026-01-22-ban-javascript-in-core-module.md`
- `2026-01-22-do-not-break-user-visible-behavior.md`

### 文件格式

```markdown
# {决策标题}

## 一句话结论
> [用一句话说明最终决策]

## 上下文链接
- 基于：[[前置决策或知识]]
- 导致：[[后续影响或流程]]
- 相关：[[相关主题]]

## Context
触发这条决策的背景是什么？

## Problem
它解决的真实问题是什么？（不是想象问题）

## Alternatives Considered
- 方案 A: xxx（为何不用）
- 方案 B: xxx（为何不用）

## Decision
最终选择了什么，为什么？

## Consequence
- 降低了哪些风险？
- 让后续维护者可以做出哪些更好选择？

## Key Files
- `path/to/file` - 相关实现或文档
```

### 示例

```markdown
# 避免删除链表节点时使用特殊分支

## Context
维护遗留代码时，删除逻辑存在“头节点特殊分支”。

## Problem
该实现有两个问题：
- 逻辑分裂成两条路径，审查时需要脑内合并。
- 后续变更必须同时覆盖“头节点”和“非头节点”，错误率上升。

## Alternatives Considered
- 保留现状：继续维护特殊分支。
- 使用 pointer-to-pointer：让所有节点走同一路径。

## Decision
改为 pointer-to-pointer，消除头节点特殊分支。

## Consequence
- 删除路径统一，审查更容易。
- 维护者无需再模拟两套分支。
```

## 备注

- Decision 强依赖上下文，必须写清 Context
- 没有 Alternatives Considered 的决策通常不完整
- 团队偏好型决策必须明确标注，避免被误当成普适规则
