# Design 模板

**执行者**：主窗口

**用途**：需要权衡多个方案时，记录选择和理由。

**何时写**：
- 实现方式不显而易见
- 有多个可行方案需要权衡
- 决策会影响后续开发

---

## 写作要求

- 在 `loop/{date}-{slug}/design.md` 创建
- 设计过程中进行必要的代码探索
- 用户确认后，将路径记录到 `_context.md`

## 必须包含

- **上下文引用**：设计依据的信息来源
- **方案概述**：怎么做
- **决策理由**：为什么这样做
- **备选方案**：考虑过但放弃的方案
- **风险**：可能出问题的地方

---

## 文档格式

```markdown
# 设计

## 上下文引用

| 类型 | 路径 | 关键内容 |
|------|------|----------|
| requirement | `loop/{date}-{slug}/requirements.md` | 核心问题：... |
| decision | `decisions/2026-01-20-xxx.md` | "引用原文" |
| maxim | `maxims/linus.md` | "好的品味" |
| 对话 | _context.md#需求澄清 | 用户说："..." |
| skill | `skills/xxx/SKILL.md` | 相关能力 |

## 方案概述

[概要描述怎么做，不要太细节]

## 决策理由

| 决策点 | 选择 | 理由 | 依据 |
|--------|------|------|------|
| [问题1] | [方案] | [为什么] | 引用上下文 |
| [问题2] | [方案] | [为什么] | 引用上下文 |

## 备选方案

### 方案 A: [名称]
- 描述：[怎么做]
- 放弃原因：[为什么不选]

### 方案 B: [名称]
- 描述：[怎么做]
- 放弃原因：[为什么不选]

## 风险

| 风险 | 影响 | 应对 |
|------|------|------|
| [风险1] | [后果] | [措施] |
| [风险2] | [后果] | [措施] |
```

---

## 上下文记录

**必须记录到 `_context.md`**：
- 关键设计决策及讨论过程
- 用户对方案的反馈
- 设计变更及原因

**示例**：
```markdown
## 关键对话

### 设计决策 (2026-01-23)

讨论：状态同步机制

方案对比：
1. PID 绑定 - 用后台进程维护映射
2. .active 文件 - 简单的 JSON 文件

用户倾向：方案 2，理由是"越简单越好"

最终选择：.active 文件方案
```

---

## 常见陷阱

| 陷阱 | 应对 |
|------|------|
| 只写方案不写理由 | "为什么"比"怎么做"更重要 |
| 没有备选方案 | 至少想过一个替代方案 |
| 忽略风险 | 诚实面对可能出问题的地方 |
| 写太细 | 这是设计不是实现，保持概要 |
| 脱离需求 | 每个设计决策应追溯到需求 |
